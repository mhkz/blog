(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{679:function(s,a,t){"use strict";t.r(a);var e=t(5),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("普通的主从集群下，主节点承担了所有的写操作与传播修改操作"),t("br"),s._v("\n这样在从节点的读效率非常快的时候时间就被这些地方影响了"),t("br"),s._v("\n如果将主节点拆为多个可并行的主节点，每个主节点负责不同的 "),t("code",[s._v("key")]),s._v(" 管理，写和传播修改效果会大大改善"),t("br"),s._v("\n这也是一种 "),t("strong",[s._v("分布式开发理念，在 Redis 中担任 Cluster 集群的身份")])]),s._v(" "),t("p",[s._v("Cluster 集群具备多主多从，每个主节点管理不同的 "),t("code",[s._v("key")]),t("br"),s._v("\n一个切片集群具备 "),t("span",{staticClass:"katex"},[t("span",{staticClass:"katex-mathml"},[t("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[t("semantics",[t("mrow",[t("mn",[s._v("16384")])],1),t("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("16384")])],1)],1)],1),t("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[t("span",{staticClass:"base"},[t("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),t("span",{staticClass:"mord"},[s._v("1")]),t("span",{staticClass:"mord"},[s._v("6")]),t("span",{staticClass:"mord"},[s._v("3")]),t("span",{staticClass:"mord"},[s._v("8")]),t("span",{staticClass:"mord"},[s._v("4")])])])]),s._v(" 个哈希槽，默认平均分配到几个主节点上，当然也可以手动分配"),t("br"),s._v("\n对于一个字符串 "),t("code",[s._v("key")]),s._v(" 通过 "),t("a",{attrs:{href:"https://en.wikipedia.org/wiki/Cyclic_redundancy_check",target:"_blank",rel:"noopener noreferrer"}},[s._v("CRC16算法"),t("OutboundLink")],1),s._v(" 得到的结果模 "),t("span",{staticClass:"katex"},[t("span",{staticClass:"katex-mathml"},[t("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[t("semantics",[t("mrow",[t("mn",[s._v("16384")])],1),t("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("16384")])],1)],1)],1),t("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[t("span",{staticClass:"base"},[t("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),t("span",{staticClass:"mord"},[s._v("1")]),t("span",{staticClass:"mord"},[s._v("6")]),t("span",{staticClass:"mord"},[s._v("3")]),t("span",{staticClass:"mord"},[s._v("8")]),t("span",{staticClass:"mord"},[s._v("4")])])])]),s._v(" 后，存放到对应的主节点")]),s._v(" "),t("p",[s._v("下面我们来搭一下看看效果：")]),s._v(" "),t("p",[s._v("首先就是 Redis 的搭建，这里不建议 "),t("code",[s._v("wget")]),s._v(" 下来后自己 "),t("code",[s._v("make")]),s._v(" 编译，很多坑，建议 Linux 用户直接")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sudo apt-get install redis\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后选一个自己要搭建集群的目录，进入后写这样六个文件（对应六个节点的端口，这里采用三从三主）")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608222854.png",alt:"20230608222854"}})]),s._v(" "),t("p",[s._v("对于文件 "),t("code",[s._v("redis7001.conf")]),s._v(" ，内容为")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608223122.png",alt:"20230608223122"}})]),s._v(" "),t("p",[s._v("至于别的文件就把端口换一下就行了")]),s._v(" "),t("p",[s._v("然后由于我们刚刚下了 Redis ，这里可以直接调用 redis-server 运行这六个文件，代表打开这六个端口")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608223337.png",alt:"20230608223337"}})]),s._v(" "),t("p",[s._v("显示一下它们的状态，输入 "),t("code",[s._v("ps -ef | grep redis")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608223653.png",alt:"20230608223653"}})]),s._v(" "),t("p",[s._v("这样就说明打开了这六个端口，我们对前三个端口设置为三个主节点，输入")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("redis-cli --cluster create 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608223807.png",alt:"20230608223807"}})]),s._v(" "),t("p",[s._v("设置成功后我们从 "),t("code",[s._v("7001")]),s._v(" 进入 Redis 命令窗，输入 "),t("code",[s._v("redis-cli -p 7001 -c")]),t("br"),s._v("\n并在另一个窗口从 "),t("code",[s._v("7002")]),s._v(" 进入 Redis 命令窗，输入 "),t("code",[s._v("redis-cli -p 7002 -c")])]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("7001")]),s._v(" 处写入 "),t("code",[s._v("SET k1 v1")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608224305.png",alt:"20230608224305"}})]),s._v(" "),t("p",[s._v("可以看到写入成功并计算后处于哈希槽 "),t("span",{staticClass:"katex"},[t("span",{staticClass:"katex-mathml"},[t("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[t("semantics",[t("mrow",[t("mn",[s._v("12706")])],1),t("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("12706")])],1)],1)],1),t("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[t("span",{staticClass:"base"},[t("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),t("span",{staticClass:"mord"},[s._v("1")]),t("span",{staticClass:"mord"},[s._v("2")]),t("span",{staticClass:"mord"},[s._v("7")]),t("span",{staticClass:"mord"},[s._v("0")]),t("span",{staticClass:"mord"},[s._v("6")])])])]),s._v(" ，位于节点端口 "),t("span",{staticClass:"katex"},[t("span",{staticClass:"katex-mathml"},[t("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[t("semantics",[t("mrow",[t("mn",[s._v("7003")])],1),t("annotation",{attrs:{encoding:"application/x-tex"}},[s._v("7003")])],1)],1)],1),t("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[t("span",{staticClass:"base"},[t("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),t("span",{staticClass:"mord"},[s._v("7")]),t("span",{staticClass:"mord"},[s._v("0")]),t("span",{staticClass:"mord"},[s._v("0")]),t("span",{staticClass:"mord"},[s._v("3")])])])]),s._v(" 处，并带着我们在后面直接跳转了"),t("br"),s._v("\n然后看一下另一个端口如果 "),t("code",[s._v("GET k1")]),s._v(" 会发生什么")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://cr-demo-blog-1308117710.cos.ap-nanjing.myqcloud.com/chivas-regal/20230608224437.png",alt:"20230608224437"}})]),s._v(" "),t("p",[s._v("可以看到几乎是一样的事情，计算并帮我们跳转到 "),t("code",[s._v("7003")]),s._v(" 后获取")]),s._v(" "),t("p",[s._v("这样我们就可以确定，Redis 是先对键字符串求完在哪个节点上后，帮我们跳转过去再求得在该节点上的操作后的结果"),t("br"),s._v("\n至此 Cluster 集群搭建与使用完毕")])])}),[],!1,null,null,null);a.default=n.exports}}]);