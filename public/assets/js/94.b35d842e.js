(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{675:function(t,a,s){"use strict";s.r(a);var e=s(5),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#功能"}},[t._v("#")]),t._v(" 功能")]),t._v(" "),s("p",[t._v("这里希望实现一个类似于 "),s("span",{staticClass:"katex"},[s("span",{staticClass:"katex-mathml"},[s("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[s("semantics",[s("mrow",[s("mi",[t._v("Q")]),s("mi",[t._v("Q")])],1),s("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("QQ")])],1)],1)],1),s("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[s("span",{staticClass:"base"},[s("span",{staticClass:"strut",staticStyle:{height:"0.8777699999999999em","vertical-align":"-0.19444em"}}),s("span",{staticClass:"mord mathnormal"},[t._v("Q")]),s("span",{staticClass:"mord mathnormal"},[t._v("Q")])])])]),t._v(" 的通讯设备"),s("br"),t._v("\n通讯双方为客户端和服务端，客户端在请求连接服务端的时候需要先登录（注册），账号和密码对应上了就可以进行聊天了"),s("br"),t._v("\n聊天方式为客户端一句，服务端一句，一端发送了一句话，另一端会原封不动收到这句话")]),t._v(" "),s("h2",{attrs:{id:"技术"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#技术"}},[t._v("#")]),t._v(" 技术")]),t._v(" "),s("p",[t._v("（纯C++实现）")]),t._v(" "),s("ul",[s("li",[t._v("基于 "),s("code",[t._v("Socket")]),t._v(" 的 "),s("code",[t._v("Reactor")]),t._v(" 模式高性能服务器，"),s("code",[t._v("epoll")]),t._v(" 实现 I/O 复用")]),t._v(" "),s("li",[t._v("借助阿里云服务器公网完成跨局域网通信")]),t._v(" "),s("li",[t._v("连接 "),s("code",[t._v("mysql")]),t._v(" 管理可通讯账号")])]),t._v(" "),s("h2",{attrs:{id:"运行过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行过程"}},[t._v("#")]),t._v(" 运行过程")]),t._v(" "),s("p",[s("RouterLink",{attrs:{to:"/blog/cppbases/server/bepack.html"}},[t._v("这里")]),t._v(" 的时序图画了纯后台的服务器运行模式"),s("br"),t._v(" "),s("RouterLink",{attrs:{to:"/blog/cppbases/mysql/mysqlmanager.html"}},[t._v("这里")]),t._v(" 讲解了c++连接 mysql 操作表的方式"),s("br"),t._v("\n下面介绍在服务器运行之外的一个客户端对服务端信息传递的部分：")],1),t._v(" "),s("p",[t._v("登录发生在这个客户端初次连接时，这个时候客户端应先选择注册还是登录，并将选择信息传递给服务端，这样两端可以保持要么同时处理登录要么同时处理注册，服务端核心函数为 "),s("code",[t._v("Server::handleLoginEvent")])]),t._v(" "),s("ul",[s("li",[t._v("登录：客户端每次发完账号和密码交给服务端验证，服务端返回“正确”或者“失败”，客户端根据返回值来决定是重新登录还是直接进入对话模式")]),t._v(" "),s("li",[t._v("注册：客户端发完账号、密码、重复密码后，自行验证密码和重复密码是否一致，一致的话提交给服务端直接进入对话，服务端将信息塞入 mysql")])]),t._v(" "),s("p",[t._v("（由于在服务端内也存在一套循环机制，所以如果脱离客户端强行破解则无法结束服务端的循环，不会对服务端产生伤害）"),s("br"),t._v("\n在登录或者注册成功后，本 "),s("code",[t._v("Server")]),t._v(" 对象内 "),s("code",[t._v("clntChannel")]),t._v(" 的回调函数将会是 "),s("code",[t._v("Server::handleReadEvent")])]),t._v(" "),s("p",[t._v("至于对话，就是简单的客户端先 "),s("code",[t._v("send")]),t._v(" 一句，服务端 "),s("code",[t._v("recv")]),t._v(" 阻塞运行直到收到客户端发送的信息，然后是服务端 "),s("code",[t._v("send")]),t._v(" 客户端阻塞")]),t._v(" "),s("h2",{attrs:{id:"项目结构及使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#项目结构及使用"}},[t._v("#")]),t._v(" 项目结构及使用")]),t._v(" "),s("h3",{attrs:{id:"结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#结构"}},[t._v("#")]),t._v(" 结构")]),t._v(" "),s("p",[t._v("一套是 "),s("code",[t._v("Server")]),t._v(" 端，一套是 "),s("code",[t._v("Client")]),t._v(" 端，两者分开运行"),s("br"),t._v(" "),s("code",[t._v("Server/src")]),t._v(" 内存放的是服务器的连接和运行模式"),s("br"),t._v(" "),s("code",[t._v("Server/usrinfo")]),t._v(" 内存放的是服务端管理可通讯账号的接口"),s("br"),t._v(" "),s("code",[t._v("Server/server.cpp")]),t._v(" 启动服务器"),s("br"),t._v(" "),s("code",[t._v("Client/src")]),t._v(" 用于开启 Socket"),s("br"),t._v(" "),s("code",[t._v("Client/client.cpp")]),t._v(" 用于连接服务端并与其对话")]),t._v(" "),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("p",[t._v("在运行之前需要手动配置几样东西，在这些文件中均用尖括号表示出来了")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("/Server/src/Acceptor.cpp")]),t._v(" 的第 "),s("span",{staticClass:"katex"},[s("span",{staticClass:"katex-mathml"},[s("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[s("semantics",[s("mrow",[s("mn",[t._v("5")])],1),s("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("5")])],1)],1)],1),s("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[s("span",{staticClass:"base"},[s("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),s("span",{staticClass:"mord"},[t._v("5")])])])]),t._v(" 行")]),t._v(" "),s("li",[s("code",[t._v("/Server/usrinfo/SqlManager.h")]),t._v(" 的第 "),s("span",{staticClass:"katex"},[s("span",{staticClass:"katex-mathml"},[s("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[s("semantics",[s("mrow",[s("mn",[t._v("10")]),s("mo",{attrs:{separator:"true"}},[t._v(",")]),s("mn",[t._v("11")]),s("mo",{attrs:{separator:"true"}},[t._v(",")]),s("mn",[t._v("13")])],1),s("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("10,11,13")])],1)],1)],1),s("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[s("span",{staticClass:"base"},[s("span",{staticClass:"strut",staticStyle:{height:"0.8388800000000001em","vertical-align":"-0.19444em"}}),s("span",{staticClass:"mord"},[t._v("1")]),s("span",{staticClass:"mord"},[t._v("0")]),s("span",{staticClass:"mpunct"},[t._v(",")]),s("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.16666666666666666em"}}),s("span",{staticClass:"mord"},[t._v("1")]),s("span",{staticClass:"mord"},[t._v("1")]),s("span",{staticClass:"mpunct"},[t._v(",")]),s("span",{staticClass:"mspace",staticStyle:{"margin-right":"0.16666666666666666em"}}),s("span",{staticClass:"mord"},[t._v("1")]),s("span",{staticClass:"mord"},[t._v("3")])])])]),t._v(" 行")]),t._v(" "),s("li",[s("code",[t._v("/Client/client.cpp")]),t._v(" 的第 "),s("span",{staticClass:"katex"},[s("span",{staticClass:"katex-mathml"},[s("math",{attrs:{xmlns:"http://www.w3.org/1998/Math/MathML"}},[s("semantics",[s("mrow",[s("mn",[t._v("20")])],1),s("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("20")])],1)],1)],1),s("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[s("span",{staticClass:"base"},[s("span",{staticClass:"strut",staticStyle:{height:"0.64444em","vertical-align":"0em"}}),s("span",{staticClass:"mord"},[t._v("2")]),s("span",{staticClass:"mord"},[t._v("0")])])])]),t._v(" 行")])]),t._v(" "),s("p",[t._v("然后要创建一个数据库，里面放一张 "),s("code",[t._v("server_user")]),t._v(" 表，只有两列："),s("code",[t._v("account")]),t._v(" 和 "),s("code",[t._v("password")]),t._v(" ，这样即可把数据库信息填入上面的 "),s("code",[t._v("SqlManager.h")]),t._v(" 中了")]),t._v(" "),s("p",[t._v("关于阿里云购买服务器使用公网以及 frp 的配置网上教程很多，这里就不赘述了")]),t._v(" "),s("p",[t._v("本项目的 "),s("code",[t._v("Server")]),t._v(" 和 "),s("code",[t._v("Client")]),t._v(" 可以放在不同局域网的不同主机上"),s("br"),t._v("\n在公网服务器上运行 "),s("code",[t._v("frps")]),t._v(" 然后再 "),s("code",[t._v("server")]),t._v("端服务器上运行 "),s("code",[t._v("frpc")]),s("br"),t._v("\n先运行 "),s("code",[t._v("Server/server.cpp")]),t._v(" 再运行 "),s("code",[t._v("Client/client.cpp")]),s("br"),t._v("\n命令参考：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("g++ src/Acceptor.cpp src/Channel.cpp src/Epoll.cpp src/EventLoop.cpp src/InetAddress.cpp src/Server.cpp src/Socket.cpp src/util.cpp usrinfo/SqlManager.cpp usrinfo/StudentInfo.cpp usrinfo/UserInfo.cpp server.cpp -o server -lmysqlclient && ./server\n\ng++ src/InetAddress src/Socket.cpp src/util.cpp client.cpp -o client && ./client\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("h3",{attrs:{id:"演示"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#演示"}},[t._v("#")]),t._v(" 演示")]),t._v(" "),s("p",[t._v("首先阿里云服务器启动 "),s("code",[t._v("frp")]),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230215214336.png",alt:"20230215214336"}})]),t._v(" "),s("p",[t._v("然后装 "),s("code",[t._v("Server")]),t._v(" 端的主机启动 "),s("code",[t._v("frp")]),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230215214430.png",alt:"20230215214430"}}),s("br"),t._v("\n同时阿里云服务器接到响应显示："),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230215214502.png",alt:"20230215214502"}})]),t._v(" "),s("p",[t._v("紧接着运行 "),s("code",[t._v("Server/server.cpp")]),s("br"),t._v("\n再运行 "),s("code",[t._v("Client/client.cpp")]),t._v(' （此时 Server 端会发送一个 "client fd <一个数字> login"'),s("br"),t._v("\n然后进入登录环节，查一下我们的用户表："),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/!%5B20230216085851%5D(httpsraw.githubusercontent.comTequila-AvagePicGoBedsmaster20230216085851.png).png",alt:""}}),t._v("\n然后进行登录"),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230216085812.png",alt:"20230216085812"}}),s("br"),t._v("\n这里先错输入了一个不存在的账号密码，然后会反馈一个失败码，继续重新输入信息")]),t._v(" "),s("p",[t._v("下面是成功登录并进入对话的展示"),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230216090552.png",alt:"20230216090552"}}),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230216090615.png",alt:"20230216090615"}})]),t._v(" "),s("p",[t._v("另外一个功能，注册，尝试一下"),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230216090816.png",alt:"20230216090816"}}),s("br"),t._v("\n这里也是先尝试了一下重复密码和原来密码不同的效果，重新输入信息，相同后服务端反馈了一个 "),s("code",[t._v("Successfully insert!")]),s("br"),t._v("\n我们看一下服务端那边的数据库"),s("br"),t._v(" "),s("img",{attrs:{src:"https://raw.githubusercontent.com/Tequila-Avage/PicGoBeds/master/20230216090928.png",alt:"20230216090928"}}),s("br"),t._v("\n成功录上了，我们下次就可以继续用这个号了")]),t._v(" "),s("h2",{attrs:{id:"源代码地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#源代码地址"}},[t._v("#")]),t._v(" 源代码地址")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/Chivas-Regal/CppLearn/tree/main/UserTalk1",target:"_blank",rel:"noopener noreferrer"}},[t._v("传送门"),s("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);